<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <!-- Для мобильной адаптации -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Мои напоминания</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      padding-bottom: 120px; /* отступ снизу, чтобы кнопка/панель не перекрывали контент */
      transition: background-color 0.3s, color 0.3s;
      /* Цвета будут переопределяться через стили в JS */
      background-color: #fff; 
      color: #000;
    }
    h1 {
      margin-bottom: 20px;
    }
    button, select, input {
      font-size: 14px;
      padding: 6px 10px;
      cursor: pointer;
    }
    button.delete {
      background-color: #ff5555;
      color: #fff;
      border: none;
    }

    /* Строка для ввода */
    .row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    /* Контейнер для категорий */
    #categoriesContainer {
      margin-top: 20px;
    }
    .category-panel {
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
    }
    .category-header {
      margin: 0;
      padding: 10px;
      background-color: #f5f5f5; /* переопределяется */
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .category-header h2 {
      margin: 0;
      font-size: 16px;
    }
    .category-content {
      display: none; /* свернут */
      padding: 10px;
    }

    /* Отдельный блок одного напоминания */
    .reminder-item {
      background-color: #fafafa; /* переопределяется */
      margin: 8px 0;
      padding: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    /* КНОПКА &laquo;ТЕМА&raquo; — снизу справа */
    #themeToggle {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 9999;
      border-radius: 4px;
      background-color: #888;
      color: #fff;
      border: none;
    }

    /* ПАНЕЛЬ НАСТРОЕК ТЕМЫ */
    #themePanel {
      position: fixed;
      bottom: 70px;
      right: 20px;
      z-index: 9999;
      background: #eee;
      color: #000;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 10px;
      width: 250px;
      display: none; /* по умолчанию спрятано */
    }
    #themePanel label {
      display: block;
      margin-top: 10px;
    }
    #themePanel h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
    }
    .theme-presets {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }

    /* Адаптация под мобильные */
    @media (max-width: 600px) {
      .row {
        flex-direction: column;
        align-items: stretch;
      }
      .row > * {
        flex: 1 1 auto;
      }
      #themeToggle {
        right: 10px;
        bottom: 10px;
      }
      #themePanel {
        right: 10px;
        width: 90%;
      }
    }
  </style>
</head>
<body>

  <h1 id="title">Мои напоминания</h1>

  <!-- Форма для нового напоминания -->
  <div class="row">
    <input type="text" id="reminderText" placeholder="Текст напоминания" />
    <input type="date" id="reminderDate" />
    <input type="time" id="reminderTime" />

    <select id="reminderCategory">
      <option value="Работа">Работа</option>
      <option value="Личное">Личное</option>
      <option value="Учёба">Учёба</option>
    </select>

    <select id="reminderRepeat">
      <option value="none">Без повтора</option>
      <option value="10m">Каждые 10 минут</option>
      <option value="1h">Каждый час</option>
      <option value="1d">Каждый день</option>
      <option value="1w">Раз в неделю</option>
      <option value="1M">Каждый месяц</option>
    </select>

    <button id="addReminder">Добавить</button>

    <select id="languageSelect">
      <option value="ru">Рус</option>
      <option value="en">Eng</option>
      <option value="uk">Укр</option>
    </select>
  </div>

  <!-- Категории + список напоминаний -->
  <div id="categoriesContainer"></div>

  <!-- Кнопка "Тема" -->
  <button id="themeToggle">Тема</button>

  <!-- Панелька настроек темы -->
  <div id="themePanel">
    <h3 id="themeSettingsTitle">Настройка темы</h3>

    <label id="labelBodyBgColor">
      Цвет фона страницы:
      <input type="color" id="bodyBgColor" value="#ffffff">
    </label>

    <label id="labelBodyTextColor">
      Цвет текста страницы:
      <input type="color" id="bodyTextColor" value="#000000">
    </label>

    <label id="labelPanelBgColor">
      Цвет фона панели категории:
      <input type="color" id="panelBgColor" value="#f5f5f5">
    </label>

    <label id="labelItemBgColor">
      Цвет фона напоминания:
      <input type="color" id="itemBgColor" value="#fafafa">
    </label>

    <label id="labelPanelTextColor">
      Цвет текста в панелях/напоминаниях:
      <input type="color" id="panelTextColor" value="#000000">
    </label>

    <!-- НАСТРОЙКА КНОПОК -->
    <label id="labelAddBtnBgColor">
      Цвет фона кнопки &laquo;Добавить&raquo;:
      <input type="color" id="addBtnBgColor" value="#008000">
    </label>
    <label id="labelAddBtnTextColor">
      Цвет текста кнопки &laquo;Добавить&raquo;:
      <input type="color" id="addBtnTextColor" value="#ffffff">
    </label>

    <label id="labelDeleteBtnBgColor">
      Цвет фона кнопки &laquo;Удалить&raquo;:
      <input type="color" id="deleteBtnBgColor" value="#ff5555">
    </label>
    <label id="labelDeleteBtnTextColor">
      Цвет текста кнопки &laquo;Удалить&raquo;:
      <input type="color" id="deleteBtnTextColor" value="#ffffff">
    </label>

    <label id="labelThemeBtnBgColor">
      Цвет фона кнопки &laquo;Тема&raquo;:
      <input type="color" id="themeBtnBgColor" value="#888888">
    </label>
    <label id="labelThemeBtnTextColor">
      Цвет текста кнопки &laquo;Тема&raquo;:
      <input type="color" id="themeBtnTextColor" value="#ffffff">
    </label>

    <div class="theme-presets">
      <button id="whiteThemeButton">Белая тема</button>
      <button id="blackThemeButton">Чёрная тема</button>
    </div>

    <div style="margin-top: 10px;">
      <button id="saveCustomTheme">Применить</button>
      <button id="resetCustomTheme">Сбросить</button>
    </div>
  </div>

  <script>
    // ================ 1) ДАННЫЕ ================
    let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    let reminderTimeouts = [];

    // Текущий язык
    let currentLang = localStorage.getItem('language') || 'ru';

    // ================ 2) ПЕРЕВОДЫ (ЯЗЫКИ) ================
    const translations = {
      ru: {
        title:             "Мои напоминания",
        placeholderText:   "Текст напоминания",
        addBtn:            "Добавить",
        repeatNone:        "Без повтора",
        every10m:          "Каждые 10 минут",
        every1h:           "Каждый час",
        every1d:           "Каждый день",
        every1w:           "Раз в неделю",
        every1M:           "Каждый месяц",
        themeBtn:          "Тема",
        work:              "Работа",
        personal:          "Личное",
        study:             "Учёба",
        deleteBtn:         "Удалить",

        // Панель настройки темы
        themeSettingsTitle:"Настройка темы",
        labelBodyBgColor:  "Цвет фона страницы:",
        labelBodyTextColor:"Цвет текста страницы:",
        labelPanelBgColor: "Цвет фона панели категории:",
        labelItemBgColor:  "Цвет фона напоминания:",
        labelPanelTextColor: "Цвет текста в панелях/напоминаниях:",
        labelAddBtnBgColor:   "Цвет фона кнопки &laquo;Добавить&raquo;:",
        labelAddBtnTextColor: "Цвет текста кнопки &laquo;Добавить&raquo;:",
        labelDeleteBtnBgColor: "Цвет фона кнопки &laquo;Удалить&raquo;:",
        labelDeleteBtnTextColor:"Цвет текста кнопки &laquo;Удалить&raquo;:",
        labelThemeBtnBgColor:  "Цвет фона кнопки &laquo;Тема&raquo;:",
        labelThemeBtnTextColor:"Цвет текста кнопки &laquo;Тема&raquo;:",
        whiteThemeButton:  "Белая тема",
        blackThemeButton:  "Чёрная тема",
        saveCustomTheme:   "Применить",
        resetCustomTheme:  "Сбросить"
      },
      en: {
        title:             "My Reminders",
        placeholderText:   "Reminder text",
        addBtn:            "Add",
        repeatNone:        "No repeat",
        every10m:          "Every 10 minutes",
        every1h:           "Every hour",
        every1d:           "Every day",
        every1w:           "Once a week",
        every1M:           "Every month",
        themeBtn:          "Theme",
        work:              "Work",
        personal:          "Personal",
        study:             "Study",
        deleteBtn:         "Delete",

        themeSettingsTitle:"Theme Settings",
        labelBodyBgColor:  "Page background color:",
        labelBodyTextColor:"Page text color:",
        labelPanelBgColor: "Category panel background:",
        labelItemBgColor:  "Reminder item background:",
        labelPanelTextColor:"Panel/Reminder text color:",
        labelAddBtnBgColor:   "&laquo;Add&raquo; button background:",
        labelAddBtnTextColor: "&laquo;Add&raquo; button text color:",
        labelDeleteBtnBgColor: "&laquo;Delete&raquo; button background:",
        labelDeleteBtnTextColor:"&laquo;Delete&raquo; button text color:",
        labelThemeBtnBgColor:  "&laquo;Theme&raquo; button background:",
        labelThemeBtnTextColor:"&laquo;Theme&raquo; button text color:",
        whiteThemeButton:  "White theme",
        blackThemeButton:  "Black theme",
        saveCustomTheme:   "Apply",
        resetCustomTheme:  "Reset"
      },
      uk: {
        title:             "Мої нагадування",
        placeholderText:   "Текст нагадування",
        addBtn:            "Додати",
        repeatNone:        "Без повтору",
        every10m:          "Кожні 10 хвилин",
        every1h:           "Щогодини",
        every1d:           "Щодня",
        every1w:           "Раз на тиждень",
        every1M:           "Щомісяця",
        themeBtn:          "Тема",
        work:              "Робота",
        personal:          "Особисте",
        study:             "Навчання",
        deleteBtn:         "Видалити",

        themeSettingsTitle:"Налаштування теми",
        labelBodyBgColor:  "Колір фону сторінки:",
        labelBodyTextColor:"Колір тексту сторінки:",
        labelPanelBgColor: "Фон панелі категорії:",
        labelItemBgColor:  "Фон нагадування:",
        labelPanelTextColor:"Колір тексту панелей/нагадувань:",
        labelAddBtnBgColor:   "Фон кнопки &laquo;Додати&raquo;:",
        labelAddBtnTextColor: "Колір тексту кнопки &laquo;Додати&raquo;:",
        labelDeleteBtnBgColor: "Фон кнопки &laquo;Видалити&raquo;:",
        labelDeleteBtnTextColor:"Колір тексту кнопки &laquo;Видалити&raquo;:",
        labelThemeBtnBgColor:  "Фон кнопки &laquo;Тема&raquo;:",
        labelThemeBtnTextColor:"Колір тексту кнопки &laquo;Тема&raquo;:",
        whiteThemeButton:  "Біла тема",
        blackThemeButton:  "Чорна тема",
        saveCustomTheme:   "Застосувати",
        resetCustomTheme:  "Скинути"
      }
    };

    // ============== Храним настройки цвета в localStorage ==============
    function loadCustomColors() {
      const saved = localStorage.getItem('customColors');
      if (!saved) {
        return {
          bodyBg:   "#ffffff",
          bodyText: "#000000",
          panelBg:  "#f5f5f5",
          itemBg:   "#fafafa",
          panelText:"#000000",
          addBtnBg: "#008000",
          addBtnText: "#ffffff",
          deleteBtnBg: "#ff5555",
          deleteBtnText: "#ffffff",
          themeBtnBg: "#888888",
          themeBtnText: "#ffffff"
        };
      }
      return JSON.parse(saved);
    }
    let customColors = loadCustomColors();

    function saveCustomColors() {
      localStorage.setItem('customColors', JSON.stringify(customColors));
    }

    // ============== ССЫЛКИ НА ЭЛЕМЕНТЫ DOM ==============
    const titleEl             = document.getElementById('title');
    const reminderTextInput   = document.getElementById('reminderText');
    const reminderDateInput   = document.getElementById('reminderDate');
    const reminderTimeInput   = document.getElementById('reminderTime');
    const reminderCategorySel = document.getElementById('reminderCategory');
    const reminderRepeatSel   = document.getElementById('reminderRepeat');
    const addReminderBtn      = document.getElementById('addReminder');
    const languageSelect      = document.getElementById('languageSelect');
    const categoriesContainer = document.getElementById('categoriesContainer');

    const themeToggleBtn      = document.getElementById('themeToggle');
    const themePanel          = document.getElementById('themePanel');
    const themeSettingsTitle  = document.getElementById('themeSettingsTitle');

    // Цветовые пикеры
    const bodyBgColor      = document.getElementById('bodyBgColor');
    const bodyTextColor    = document.getElementById('bodyTextColor');
    const panelBgColor     = document.getElementById('panelBgColor');
    const itemBgColor      = document.getElementById('itemBgColor');
    const panelTextColor   = document.getElementById('panelTextColor');
    const addBtnBgColor    = document.getElementById('addBtnBgColor');
    const addBtnTextColor  = document.getElementById('addBtnTextColor');
    const deleteBtnBgColor = document.getElementById('deleteBtnBgColor');
    const deleteBtnTextColor = document.getElementById('deleteBtnTextColor');
    const themeBtnBgColor    = document.getElementById('themeBtnBgColor');
    const themeBtnTextColor  = document.getElementById('themeBtnTextColor');

    const whiteThemeButton = document.getElementById('whiteThemeButton');
    const blackThemeButton = document.getElementById('blackThemeButton');
    const saveCustomTheme  = document.getElementById('saveCustomTheme');
    const resetCustomTheme = document.getElementById('resetCustomTheme');

    // Label для цветовых пикеров (меняем язык)
    const labelBodyBgColor        = document.getElementById('labelBodyBgColor');
    const labelBodyTextColor      = document.getElementById('labelBodyTextColor');
    const labelPanelBgColor       = document.getElementById('labelPanelBgColor');
    const labelItemBgColor        = document.getElementById('labelItemBgColor');
    const labelPanelTextColor     = document.getElementById('labelPanelTextColor');
    const labelAddBtnBgColor      = document.getElementById('labelAddBtnBgColor');
    const labelAddBtnTextColor    = document.getElementById('labelAddBtnTextColor');
    const labelDeleteBtnBgColor   = document.getElementById('labelDeleteBtnBgColor');
    const labelDeleteBtnTextColor = document.getElementById('labelDeleteBtnTextColor');
    const labelThemeBtnBgColor    = document.getElementById('labelThemeBtnBgColor');
    const labelThemeBtnTextColor  = document.getElementById('labelThemeBtnTextColor');

    // ============== 3) ПРИМЕНЕНИЕ ПЕРЕВОДОВ ==============
    function applyTranslations() {
      const t = translations[currentLang];
      if (!t) return;

      // Основной интерфейс
      titleEl.textContent                    = t.title;
      reminderTextInput.placeholder          = t.placeholderText;
      addReminderBtn.textContent             = t.addBtn;
      themeToggleBtn.textContent             = t.themeBtn;

      // Повторы
      reminderRepeatSel.options[0].text = t.repeatNone;
      reminderRepeatSel.options[1].text = t.every10m;
      reminderRepeatSel.options[2].text = t.every1h;
      reminderRepeatSel.options[3].text = t.every1d;
      reminderRepeatSel.options[4].text = t.every1w;
      reminderRepeatSel.options[5].text = t.every1M;

      // Категории
      reminderCategorySel.options[0].text = t.work;
      reminderCategorySel.options[1].text = t.personal;
      reminderCategorySel.options[2].text = t.study;

      // Панель настройки темы
      themeSettingsTitle.textContent = t.themeSettingsTitle;
      labelBodyBgColor.firstChild.textContent        = t.labelBodyBgColor + " ";
      labelBodyTextColor.firstChild.textContent      = t.labelBodyTextColor + " ";
      labelPanelBgColor.firstChild.textContent       = t.labelPanelBgColor + " ";
      labelItemBgColor.firstChild.textContent        = t.labelItemBgColor + " ";
      labelPanelTextColor.firstChild.textContent     = t.labelPanelTextColor + " ";
      labelAddBtnBgColor.firstChild.textContent      = t.labelAddBtnBgColor + " ";
      labelAddBtnTextColor.firstChild.textContent    = t.labelAddBtnTextColor + " ";
      labelDeleteBtnBgColor.firstChild.textContent   = t.labelDeleteBtnBgColor + " ";
      labelDeleteBtnTextColor.firstChild.textContent = t.labelDeleteBtnTextColor + " ";
      labelThemeBtnBgColor.firstChild.textContent    = t.labelThemeBtnBgColor + " ";
      labelThemeBtnTextColor.firstChild.textContent  = t.labelThemeBtnTextColor + " ";

      whiteThemeButton.textContent = t.whiteThemeButton;
      blackThemeButton.textContent = t.blackThemeButton;
      saveCustomTheme.textContent  = t.saveCustomTheme;
      resetCustomTheme.textContent = t.resetCustomTheme;

      // Перерисовать категории (кнопки &laquo;Удалить&raquo; и заголовки)
      renderCategories();
    }

    languageSelect.value = currentLang;
    languageSelect.addEventListener('change', e => {
      currentLang = e.target.value;
      localStorage.setItem('language', currentLang);
      applyTranslations();
    });

    // ============== 4) ПРИМЕНЕНИЕ ПОЛЬЗОВАТЕЛЬСКИХ ЦВЕТОВ ==============
    function initColorPickers() {
      // Заполняем color-инпуты из customColors
      bodyBgColor.value         = customColors.bodyBg;
      bodyTextColor.value       = customColors.bodyText;
      panelBgColor.value        = customColors.panelBg;
      itemBgColor.value         = customColors.itemBg;
      panelTextColor.value      = customColors.panelText;
      addBtnBgColor.value       = customColors.addBtnBg;
      addBtnTextColor.value     = customColors.addBtnText;
      deleteBtnBgColor.value    = customColors.deleteBtnBg;
      deleteBtnTextColor.value  = customColors.deleteBtnText;
      themeBtnBgColor.value     = customColors.themeBtnBg;
      themeBtnTextColor.value   = customColors.themeBtnText;
    }

    function applyCustomColors() {
      // BODY
      document.body.style.backgroundColor = customColors.bodyBg;
      document.body.style.color          = customColors.bodyText;

      // Панели категорий
      document.querySelectorAll('.category-header').forEach(header => {
        header.style.backgroundColor = customColors.panelBg;
        header.style.color           = customColors.panelText;
      });
      // Карточки напоминаний
      document.querySelectorAll('.reminder-item').forEach(item => {
        item.style.backgroundColor = customColors.itemBg;
        item.style.color           = customColors.panelText;
      });

      // Кнопка &laquo;Добавить&raquo;
      addReminderBtn.style.backgroundColor = customColors.addBtnBg;
      addReminderBtn.style.color          = customColors.addBtnText;

      // Кнопки &laquo;Удалить&raquo;
      document.querySelectorAll('button.delete').forEach(delBtn => {
        delBtn.style.backgroundColor = customColors.deleteBtnBg;
        delBtn.style.color           = customColors.deleteBtnText;
      });

      // Кнопка &laquo;Тема&raquo;
      themeToggleBtn.style.backgroundColor = customColors.themeBtnBg;
      themeToggleBtn.style.color           = customColors.themeBtnText;
    }

    // ============== 5) ПРЕСЕТЫ (Белая/Чёрная тема) ==============
    whiteThemeButton.addEventListener('click', () => {
      // Устанавливаем &laquo;белый&raquo; пресет
      bodyBgColor.value         = "#ffffff";
      bodyTextColor.value       = "#000000";
      panelBgColor.value        = "#f5f5f5";
      itemBgColor.value         = "#fafafa";
      panelTextColor.value      = "#000000";

      // Кнопка &laquo;Добавить&raquo; становится белой
      addBtnBgColor.value       = "#ffffff";
      addBtnTextColor.value     = "#000000";

      // &laquo;Удалить&raquo; — красная
      deleteBtnBgColor.value    = "#ff5555";
      deleteBtnTextColor.value  = "#ffffff";

      // &laquo;Тема&raquo; — сероватая
      themeBtnBgColor.value     = "#888888";
      themeBtnTextColor.value   = "#ffffff";
    });
    blackThemeButton.addEventListener('click', () => {
      // Полностью тёмный пресет
      bodyBgColor.value         = "#222222";
      bodyTextColor.value       = "#eeeeee";
      panelBgColor.value        = "#333333";
      itemBgColor.value         = "#444444";
      panelTextColor.value      = "#ffffff";

      addBtnBgColor.value       = "#555555";
      addBtnTextColor.value     = "#ffffff";

      deleteBtnBgColor.value    = "#aa0000";
      deleteBtnTextColor.value  = "#ffffff";

      themeBtnBgColor.value     = "#666666";
      themeBtnTextColor.value   = "#ffffff";
    });

    // ============== 6) &laquo;ПРИМЕНИТЬ&raquo; / &laquo;СБРОСИТЬ&raquo; ==============
    saveCustomTheme.addEventListener('click', () => {
      customColors.bodyBg       = bodyBgColor.value;
      customColors.bodyText     = bodyTextColor.value;
      customColors.panelBg      = panelBgColor.value;
      customColors.itemBg       = itemBgColor.value;
      customColors.panelText    = panelTextColor.value;
      customColors.addBtnBg     = addBtnBgColor.value;
      customColors.addBtnText   = addBtnTextColor.value;
      customColors.deleteBtnBg  = deleteBtnBgColor.value;
      customColors.deleteBtnText= deleteBtnTextColor.value;
      customColors.themeBtnBg   = themeBtnBgColor.value;
      customColors.themeBtnText = themeBtnTextColor.value;

      saveCustomColors();
      applyCustomColors();
    });

    resetCustomTheme.addEventListener('click', () => {
      // Полностью сбрасываем в дефолт
      localStorage.removeItem('customColors');
      customColors = loadCustomColors();
      initColorPickers();
      applyCustomColors();
    });

    // ============== 7) ОТОБРАЖЕНИЕ / СКРЫТИЕ ПАНЕЛИ "ТЕМА" ==============
    let themePanelOpen = false;
    themeToggleBtn.addEventListener('click', () => {
      themePanelOpen = !themePanelOpen;
      themePanel.style.display = themePanelOpen ? 'block' : 'none';
    });

    // ============== 8) НАПОМИНАНИЯ (повтор, таймеры) ==============
    function saveReminders() {
      localStorage.setItem('reminders', JSON.stringify(reminders));
    }

    function cancelAllTimers() {
      reminderTimeouts.forEach(id => clearTimeout(id));
      reminderTimeouts = [];
    }

    function formatDate(d) {
      let y = d.getFullYear();
      let m = String(d.getMonth() + 1).padStart(2, '0');
      let day = String(d.getDate()).padStart(2, '0');
      return `${y}-${m}-${day}`;
    }
    function formatTime(d) {
      let hh = String(d.getHours()).padStart(2, '0');
      let mm = String(d.getMinutes()).padStart(2, '0');
      return `${hh}:${mm}`;
    }
    function addIntervalToDate(dateObj, repeatCode) {
      switch (repeatCode) {
        case '10m':
          dateObj.setMinutes(dateObj.getMinutes() + 10);
          break;
        case '1h':
          dateObj.setHours(dateObj.getHours() + 1);
          break;
        case '1d':
          dateObj.setDate(dateObj.getDate() + 1);
          break;
        case '1w':
          dateObj.setDate(dateObj.getDate() + 7);
          break;
        case '1M':
          dateObj.setMonth(dateObj.getMonth() + 1);
          break;
      }
    }
    function showNotification(reminder) {
      if (!("Notification" in window)) {
        alert(reminder.text);
        return;
      }
      if (Notification.permission === "granted") {
        new Notification("Напоминание", { body: reminder.text });
      } else {
        alert(reminder.text);
      }
    }

    // В этой функции исправляем логику:
    // - Если время уже прошло, но напоминание повторяемое, двигаем его вперёд,
    //   пока не найдём момент в будущем.
    // - Затем ставим setTimeout именно на ту разницу.
    function resetAllTimers() {
      cancelAllTimers();
      const now = new Date();

      reminders.forEach(r => {
        // Если нет даты/времени — нет автосрабатывания
        if (!r.date && !r.time) return;

        let dt = new Date(r.date + 'T' + (r.time || '00:00'));

        // Проверяем, не прошел ли этот момент
        if (dt <= now) {
          // Если повтора нет — вообще не ставим таймер (оно &laquo;прозевано&raquo;).
          if (!r.repeat || r.repeat === 'none') {
            return;
          }
          // Иначе двигаем dt вперёд (шаг за шагом), пока не станет > now
          while (dt <= now) {
            addIntervalToDate(dt, r.repeat);
          }
          // Обновляем дату/время в самом напоминании (чтобы при перезагрузке страницы не потерялось)
          r.date = formatDate(dt);
          r.time = formatTime(dt);
          saveReminders();
        }

        // Теперь dt гарантированно в будущем => ставим таймер
        const diff = dt - new Date();
        const timerId = setTimeout(() => {
          showNotification(r);

          // Повтор?
          if (r.repeat && r.repeat !== 'none') {
            let newDT = new Date(dt);
            addIntervalToDate(newDT, r.repeat);

            r.date = formatDate(newDT);
            r.time = formatTime(newDT);
            saveReminders();
            resetAllTimers();
          } else {
            // Удаляем одноразовое
            const idx = reminders.indexOf(r);
            if (idx !== -1) {
              reminders.splice(idx, 1);
              saveReminders();
            }
            renderCategories();
          }
        }, diff);
        reminderTimeouts.push(timerId);
      });
    }

    // ============== 9) КАТЕГОРИИ ==============
    function groupByCategory() {
      // Фиксированные три категории
      const groups = { "Работа": [], "Личное": [], "Учёба": [] };
      reminders.forEach(rem => {
        if (!groups[rem.category]) {
          groups[rem.category] = [];
        }
        groups[rem.category].push(rem);
      });
      return groups;
    }
    function createCategoryPanel(catName, arr) {
      const t = translations[currentLang];
      let label = catName;
      if (t) {
        if (catName === "Работа") label = t.work;
        if (catName === "Личное") label = t.personal;
        if (catName === "Учёба")  label = t.study;
      }

      const panel = document.createElement('div');
      panel.className = 'category-panel';

      const header = document.createElement('div');
      header.className = 'category-header';
      const h2 = document.createElement('h2');
      h2.textContent = `${label} (${arr.length})`;
      const toggleSign = document.createElement('span');
      toggleSign.textContent = '▼';
      header.appendChild(h2);
      header.appendChild(toggleSign);

      const content = document.createElement('div');
      content.className = 'category-content';

      let isOpen = false;
      header.addEventListener('click', () => {
        isOpen = !isOpen;
        content.style.display = isOpen ? 'block' : 'none';
        toggleSign.textContent = isOpen ? '▲' : '▼';
      });

      // Напоминания внутри
      arr.forEach(reminder => {
        const item = document.createElement('div');
        item.className = 'reminder-item';

        let txt = reminder.text;
        let details = [];
        if (reminder.date) details.push(reminder.date);
        if (reminder.time) details.push(reminder.time);
        if (reminder.repeat && reminder.repeat !== 'none') {
          switch (reminder.repeat) {
            case '10m': details.push(t ? t.every10m : 'каждые 10 минут'); break;
            case '1h':  details.push(t ? t.every1h : 'каждый час'); break;
            case '1d':  details.push(t ? t.every1d : 'каждый день'); break;
            case '1w':  details.push(t ? t.every1w : 'раз в неделю'); break;
            case '1M':  details.push(t ? t.every1M : 'каждый месяц'); break;
          }
        }
        if (details.length > 0) {
          txt += ' (' + details.join(', ') + ')';
        }

        const textSpan = document.createElement('span');
        textSpan.textContent = txt;

        const delBtn = document.createElement('button');
        delBtn.className = 'delete';
        delBtn.textContent = t ? t.deleteBtn : "Удалить";
        delBtn.addEventListener('click', () => {
          const idx = reminders.indexOf(reminder);
          if (idx !== -1) {
            reminders.splice(idx, 1);
            saveReminders();
            resetAllTimers();
            renderCategories();
          }
        });

        item.appendChild(textSpan);
        item.appendChild(delBtn);
        content.appendChild(item);
      });

      panel.appendChild(header);
      panel.appendChild(content);
      return panel;
    }
    function renderCategories() {
      categoriesContainer.innerHTML = '';
      const groups = groupByCategory();
      for (let c in groups) {
        if (groups[c].length > 0) {
          const panel = createCategoryPanel(c, groups[c]);
          categoriesContainer.appendChild(panel);
        }
      }
      // Применяем цвета к вновь созданным элементам
      applyCustomColors();
    }

    // ============== 10) ДОБАВЛЕНИЕ НАПОМИНАНИЯ ==============
    addReminderBtn.addEventListener('click', () => {
      const textValue = reminderTextInput.value.trim();
      if (!textValue) return;
      reminders.push({
        text: textValue,
        date: reminderDateInput.value,
        time: reminderTimeInput.value,
        category: reminderCategorySel.value,
        repeat: reminderRepeatSel.value
      });
      saveReminders();
      resetAllTimers();
      renderCategories();

      // Сброс формы
      reminderTextInput.value = '';
      reminderDateInput.value = '';
      reminderTimeInput.value = '';
      reminderCategorySel.value = 'Работа';
      reminderRepeatSel.value = 'none';
    });

    // ============== 11) ИНИЦИАЛИЗАЦИЯ ПРИ СТАРТЕ ==============
    document.addEventListener('DOMContentLoaded', () => {
      // Разрешение на уведомления
      if ("Notification" in window) {
        if (Notification.permission === "default") {
          Notification.requestPermission();
        }
      }
    });

    // Применяем переводы
    applyTranslations();

    // Инициализируем и применяем цвета
    initColorPickers();
    applyCustomColors();

    // Отображаем списки
    renderCategories();
    resetAllTimers();
  </script>
</body>
</html>
