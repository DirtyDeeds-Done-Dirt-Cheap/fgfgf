<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Мои напоминания</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      padding-bottom: 120px; /* Чтобы нижние кнопки не перекрывали контент */
      transition: background-color 0.3s, color 0.3s;
      background-color: #fff; 
      color: #000;
    }
    h1 {
      margin-bottom: 20px;
    }
    button, select, input {
      font-size: 14px;
      padding: 6px 10px;
      cursor: pointer;
    }
    /* По умолчанию кнопка &laquo;Удалить&raquo; красная */
    button.delete {
      background-color: #ff5555;
      color: #fff;
      border: none;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    #categoriesContainer {
      margin-top: 20px;
    }
    .category-panel {
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
    }
    .category-header {
      margin: 0;
      padding: 10px;
      background-color: #f5f5f5; 
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }
    .category-header h2 {
      margin: 0;
      font-size: 16px;
      transition: color 0.3s;
    }
    .category-content {
      display: none; 
      padding: 10px;
    }
    .reminder-item {
      transition: background-color 0.3s, color 0.3s;
      background-color: #fafafa;
      margin: 8px 0;
      padding: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    /* Кнопка &laquo;Тема&raquo; (правый нижний угол) */
    #themeToggle {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 9999;
      background-color: #888;
      color: #fff;
      border: none;
    }

    /* Панель &laquo;Тема&raquo; (прокрутка) */
    #themePanel {
      position: fixed;
      bottom: 70px;
      right: 20px;
      z-index: 9999;
      background: #eee;
      color: #000;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 10px;
      width: 320px;
      display: none;

      max-height: 60vh; 
      overflow-y: auto; /* прокручиваемая панель */
    }
    #themePanel label {
      display: block;
      margin-top: 10px;
    }
    #themePanel h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
    }
    .theme-presets {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }

    /* Кнопка языка (левый нижний угол) */
    #languageSelect {
      position: fixed;
      left: 20px;
      bottom: 20px;
      z-index: 9999;
      cursor: pointer;
    }

    @media (max-width: 600px) {
      .row {
        flex-direction: column;
        align-items: stretch;
      }
      .row > * {
        flex: 1 1 auto;
      }
      #themeToggle {
        right: 10px;
        bottom: 10px;
      }
      #themePanel {
        right: 10px;
        width: 90%;
      }
      #languageSelect {
        left: 10px;
        bottom: 10px;
      }
    }
  </style>
</head>
<body>

  <h1 id="title">Мои напоминания</h1>

  <!-- Форма добавления напоминания -->
  <div class="row">
    <input type="text" id="reminderText" placeholder="Текст напоминания" />
    <input type="date" id="reminderDate" />
    <input type="time" id="reminderTime" />

    <select id="reminderCategory">
      <option value="Работа">Работа</option>
      <option value="Личное">Личное</option>
      <option value="Учёба">Учёба</option>
    </select>

    <select id="reminderRepeat">
      <option value="none">Без повтора</option>
      <option value="10m">Каждые 10 минут</option>
      <option value="1h">Каждый час</option>
      <option value="1d">Каждый день</option>
      <option value="1w">Раз в неделю</option>
      <option value="1M">Каждый месяц</option>
    </select>

    <button id="addReminder">Добавить</button>
  </div>

  <!-- Список категорий -->
  <div id="categoriesContainer"></div>

  <!-- Селект языка (в левом нижнем углу) -->
  <select id="languageSelect">
    <option value="ru">Рус</option>
    <option value="en">Eng</option>
    <option value="uk">Укр</option>
  </select>

  <!-- Кнопка "Тема" (правый нижний угол) -->
  <button id="themeToggle">Тема</button>

  <!-- Панель настройки темы -->
  <div id="themePanel">
    <h3 id="themeSettingsTitle">Настройка темы</h3>

    <!-- Цвет фона и текста body -->
    <label id="labelBodyBgColor">
      Цвет фона страницы:
      <input type="color" id="bodyBgColor" value="#ffffff">
    </label>
    <label id="labelBodyTextColor">
      Цвет текста страницы:
      <input type="color" id="bodyTextColor" value="#000000">
    </label>

    <!-- Форма всех полей (text, date, time, select) -->
    <label id="labelFieldShape">
      Форма полей ввода / списков:
      <br/>
      <input type="radio" name="fieldShape" value="rect" checked> Прямоугольная
      <br/>
      <input type="radio" name="fieldShape" value="round"> Закруглённая
    </label>

    <!-- Цвет фона/текста для полей -->
    <label id="labelTextInputBg">
      Цвет фона поля "Текст напоминания":
      <input type="color" id="textInputBg" value="#ffffff">
    </label>
    <label id="labelTextInputColor">
      Цвет текста поля "Текст напоминания":
      <input type="color" id="textInputColor" value="#000000">
    </label>

    <label id="labelDateInputBg">
      Цвет фона поля "Дата":
      <input type="color" id="dateInputBg" value="#ffffff">
    </label>
    <label id="labelDateInputColor">
      Цвет текста поля "Дата":
      <input type="color" id="dateInputColor" value="#000000">
    </label>

    <label id="labelTimeInputBg">
      Цвет фона поля "Время":
      <input type="color" id="timeInputBg" value="#ffffff">
    </label>
    <label id="labelTimeInputColor">
      Цвет текста поля "Время":
      <input type="color" id="timeInputColor" value="#000000">
    </label>

    <label id="labelCategoryBg">
      Цвет фона поля "Категория":
      <input type="color" id="categoryBg" value="#ffffff">
    </label>
    <label id="labelCategoryColor">
      Цвет текста поля "Категория":
      <input type="color" id="categoryColor" value="#000000">
    </label>

    <label id="labelRepeatBg">
      Цвет фона поля "Повтор":
      <input type="color" id="repeatBg" value="#ffffff">
    </label>
    <label id="labelRepeatColor">
      Цвет текста поля "Повтор":
      <input type="color" id="repeatColor" value="#000000">
    </label>

    <label id="labelLangBg">
      Цвет фона списка "Язык":
      <input type="color" id="langBg" value="#ffffff">
    </label>
    <label id="labelLangColor">
      Цвет текста списка "Язык":
      <input type="color" id="langColor" value="#000000">
    </label>

    <!-- Кнопка &laquo;Добавить&raquo; -->
    <label id="labelAddBtnBgColor">
      Цвет фона кнопки &laquo;Добавить&raquo;:
      <input type="color" id="addBtnBgColor" value="#ffffff">
    </label>
    <label id="labelAddBtnTextColor">
      Цвет текста кнопки &laquo;Добавить&raquo;:
      <input type="color" id="addBtnTextColor" value="#000000">
    </label>
    <div id="labelAddBtnShape">
      Форма кнопки &laquo;Добавить&raquo;:
      <br/>
      <input type="radio" name="addBtnShape" value="rect" checked> Прямоугольная
      <br/>
      <input type="radio" name="addBtnShape" value="round"> Закруглённая
    </div>

    <!-- Кнопка &laquo;Удалить&raquo; -->
    <label id="labelDeleteBtnBgColor">
      Цвет фона кнопки &laquo;Удалить&raquo;:
      <input type="color" id="deleteBtnBgColor" value="#ff5555">
    </label>
    <label id="labelDeleteBtnTextColor">
      Цвет текста кнопки &laquo;Удалить&raquo;:
      <input type="color" id="deleteBtnTextColor" value="#ffffff">
    </label>
    <div id="labelDeleteBtnShape">
      Форма кнопки &laquo;Удалить&raquo;:
      <br/>
      <input type="radio" name="deleteBtnShape" value="rect" checked> Прямоугольная
      <br/>
      <input type="radio" name="deleteBtnShape" value="round"> Закруглённая
    </div>

    <!-- Кнопка &laquo;Тема&raquo; -->
    <label id="labelThemeBtnBgColor">
      Цвет фона кнопки &laquo;Тема&raquo;:
      <input type="color" id="themeBtnBgColor" value="#888888">
    </label>
    <label id="labelThemeBtnTextColor">
      Цвет текста кнопки &laquo;Тема&raquo;:
      <input type="color" id="themeBtnTextColor" value="#ffffff">
    </label>
    <div id="labelThemeBtnShape">
      Форма кнопки &laquo;Тема&raquo;:
      <br/>
      <input type="radio" name="themeBtnShape" value="rect" checked> Прямоугольная
      <br/>
      <input type="radio" name="themeBtnShape" value="round"> Закруглённая
    </div>

    <!-- Дополнительно: блок напоминания (reminder-item) -->
    <label id="labelItemBgColor">
      Цвет фона "Напоминания":
      <input type="color" id="itemBgColor" value="#fafafa">
    </label>
    <label id="labelItemTextColor">
      Цвет текста "Напоминания":
      <input type="color" id="itemTextColor" value="#000000">
    </label>

    <!-- Пресеты (Белая / Чёрная) -->
    <div class="theme-presets">
      <button id="whiteThemeButton">Белая тема</button>
      <button id="blackThemeButton">Чёрная тема</button>
    </div>

    <div style="margin-top: 10px;">
      <button id="saveCustomTheme">Применить</button>
      <button id="resetCustomTheme">Сбросить</button>
    </div>
  </div>

  <script>
    /* ================================
       1) ДАННЫЕ: Напоминания, язык, настройки
    ================================ */
    let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    let reminderTimeouts = [];
    let currentLang = localStorage.getItem('language') || 'ru';

    // Храним все настройки &laquo;темы&raquo; в одном объекте (body, поля, кнопки, reminder-item)
    function loadCustomColors() {
      const saved = localStorage.getItem('customColors');
      if (!saved) {
        // Значения по умолчанию
        return {
          // Фон и текст всей страницы
          bodyBg:"#ffffff",
          bodyText:"#000000",

          // Форма для полей (text,date,time,select)
          fieldShape:"rect",

          // Цвета полей
          textInputBg:"#ffffff", textInputColor:"#000000",
          dateInputBg:"#ffffff", dateInputColor:"#000000",
          timeInputBg:"#ffffff", timeInputColor:"#000000",
          categoryBg:"#ffffff",  categoryColor:"#000000",
          repeatBg:"#ffffff",    repeatColor:"#000000",
          langBg:"#ffffff",      langColor:"#000000",

          // Кнопки (Добавить, Удалить, Тема)
          addBtnBg:"#ffffff", addBtnText:"#000000", addBtnShape:"rect",
          deleteBtnBg:"#ff5555", deleteBtnText:"#ffffff", deleteBtnShape:"rect",
          themeBtnBg:"#888888",  themeBtnText:"#ffffff",  themeBtnShape:"rect",

          // Блок .reminder-item
          itemBg:"#fafafa",
          itemText:"#000000"
        };
      }
      return JSON.parse(saved);
    }
    let customColors = loadCustomColors();

    function saveCustomColors() {
      localStorage.setItem('customColors', JSON.stringify(customColors));
    }

    // Пример переводов (небольшой словарь)
    const translations = {
      ru: {
        title:"Мои напоминания",
        placeholderReminder:"Текст напоминания",
        addBtn:"Добавить",
        themeBtn:"Тема",
        repeatNone:"Без повтора",
        every10m:"Каждые 10 минут",
        every1h:"Каждый час",
        every1d:"Каждый день",
        every1w:"Раз в неделю",
        every1M:"Каждый месяц",
        work:"Работа",
        personal:"Личное",
        study:"Учёба",
        deleteBtn:"Удалить",

        themeSettingsTitle:"Настройка темы",
        labelBodyBgColor:"Цвет фона страницы:",
        labelBodyTextColor:"Цвет текста страницы:",
        labelFieldShape:"Форма полей ввода / списков",
        labelTextInputBg:'Цвет фона поля "Текст напоминания":',
        labelTextInputColor:'Цвет текста поля "Текст напоминания":',
        labelDateInputBg:'Цвет фона поля "Дата":',
        labelDateInputColor:'Цвет текста поля "Дата":',
        labelTimeInputBg:'Цвет фона поля "Время":',
        labelTimeInputColor:'Цвет текста поля "Время":',
        labelCategoryBg:'Цвет фона поля "Категория":',
        labelCategoryColor:'Цвет текста поля "Категория":',
        labelRepeatBg:'Цвет фона поля "Повтор":',
        labelRepeatColor:'Цвет текста поля "Повтор":',
        labelLangBg:'Цвет фона списка "Язык":',
        labelLangColor:'Цвет текста списка "Язык":',

        labelAddBtnBgColor:'Цвет фона кнопки &laquo;Добавить&raquo;:',
        labelAddBtnTextColor:'Цвет текста кнопки &laquo;Добавить&raquo;:',
        labelAddBtnShape:'Форма кнопки &laquo;Добавить&raquo;:',
        labelDeleteBtnBgColor:'Цвет фона кнопки &laquo;Удалить&raquo;:',
        labelDeleteBtnTextColor:'Цвет текста кнопки &laquo;Удалить&raquo;:',
        labelDeleteBtnShape:'Форма кнопки &laquo;Удалить&raquo;:',
        labelThemeBtnBgColor:'Цвет фона кнопки &laquo;Тема&raquo;:',
        labelThemeBtnTextColor:'Цвет текста кнопки &laquo;Тема&raquo;:',
        labelThemeBtnShape:'Форма кнопки &laquo;Тема&raquo;:',

        labelItemBgColor:'Цвет фона "Напоминания":',
        labelItemTextColor:'Цвет текста "Напоминания":',

        whiteThemeButton:"Белая тема",
        blackThemeButton:"Чёрная тема",
        saveCustomTheme:"Применить",
        resetCustomTheme:"Сбросить"
      },
      // Можете добавить en / uk аналогично
    };

    function applyTranslations() {
      const t = translations[currentLang] || translations.ru;
      document.getElementById('title').textContent = t.title;
      document.getElementById('reminderText').placeholder = t.placeholderReminder;
      document.getElementById('addReminder').textContent   = t.addBtn;
      document.getElementById('themeToggle').textContent   = t.themeBtn;

      // Repeat select
      const repSel=document.getElementById('reminderRepeat');
      repSel.options[0].text=t.repeatNone;
      repSel.options[1].text=t.every10m;
      repSel.options[2].text=t.every1h;
      repSel.options[3].text=t.every1d;
      repSel.options[4].text=t.every1w;
      repSel.options[5].text=t.every1M;

      // Category select
      const catSel=document.getElementById('reminderCategory');
      catSel.options[0].text=t.work;
      catSel.options[1].text=t.personal;
      catSel.options[2].text=t.study;

      // Лейблы в панели темы
      document.getElementById('themeSettingsTitle').textContent = t.themeSettingsTitle;
      document.getElementById('labelBodyBgColor').firstChild.textContent    = t.labelBodyBgColor+" ";
      document.getElementById('labelBodyTextColor').firstChild.textContent  = t.labelBodyTextColor+" ";
      document.getElementById('labelFieldShape').firstChild.textContent     = t.labelFieldShape+":";

      document.getElementById('labelTextInputBg').firstChild.textContent    = t.labelTextInputBg+" ";
      document.getElementById('labelTextInputColor').firstChild.textContent = t.labelTextInputColor+" ";
      document.getElementById('labelDateInputBg').firstChild.textContent    = t.labelDateInputBg+" ";
      document.getElementById('labelDateInputColor').firstChild.textContent = t.labelDateInputColor+" ";
      document.getElementById('labelTimeInputBg').firstChild.textContent    = t.labelTimeInputBg+" ";
      document.getElementById('labelTimeInputColor').firstChild.textContent = t.labelTimeInputColor+" ";
      document.getElementById('labelCategoryBg').firstChild.textContent     = t.labelCategoryBg+" ";
      document.getElementById('labelCategoryColor').firstChild.textContent  = t.labelCategoryColor+" ";
      document.getElementById('labelRepeatBg').firstChild.textContent       = t.labelRepeatBg+" ";
      document.getElementById('labelRepeatColor').firstChild.textContent    = t.labelRepeatColor+" ";
      document.getElementById('labelLangBg').firstChild.textContent         = t.labelLangBg+" ";
      document.getElementById('labelLangColor').firstChild.textContent      = t.labelLangColor+" ";

      document.getElementById('labelAddBtnBgColor').firstChild.textContent     = t.labelAddBtnBgColor+" ";
      document.getElementById('labelAddBtnTextColor').firstChild.textContent   = t.labelAddBtnTextColor+" ";
      document.getElementById('labelAddBtnShape').firstChild.textContent       = t.labelAddBtnShape+":";
      document.getElementById('labelDeleteBtnBgColor').firstChild.textContent  = t.labelDeleteBtnBgColor+" ";
      document.getElementById('labelDeleteBtnTextColor').firstChild.textContent= t.labelDeleteBtnTextColor+" ";
      document.getElementById('labelDeleteBtnShape').firstChild.textContent    = t.labelDeleteBtnShape+":";
      document.getElementById('labelThemeBtnBgColor').firstChild.textContent   = t.labelThemeBtnBgColor+" ";
      document.getElementById('labelThemeBtnTextColor').firstChild.textContent = t.labelThemeBtnTextColor+" ";
      document.getElementById('labelThemeBtnShape').firstChild.textContent     = t.labelThemeBtnShape+":";

      document.getElementById('labelItemBgColor').firstChild.textContent       = t.labelItemBgColor+" ";
      document.getElementById('labelItemTextColor').firstChild.textContent     = t.labelItemTextColor+" ";

      document.getElementById('whiteThemeButton').textContent = t.whiteThemeButton;
      document.getElementById('blackThemeButton').textContent = t.blackThemeButton;
      document.getElementById('saveCustomTheme').textContent  = t.saveCustomTheme;
      document.getElementById('resetCustomTheme').textContent = t.resetCustomTheme;

      // Перерисовать категории (чтобы кнопка &laquo;Удалить&raquo; etc. перевелось)
      renderCategories();
    }

    // ====== 2) ПРИМЕНЕНИЕ НАСТРОЕК ======
    function applyCustomColors() {
      // BODY
      document.body.style.backgroundColor = customColors.bodyBg;
      document.body.style.color           = customColors.bodyText;

      // Поля (одна форма — rect/round)
      const fieldBorderRadius = (customColors.fieldShape==="round") ? "30px" : "0px";

      // reminderText
      let txtInput=document.getElementById('reminderText');
      txtInput.style.backgroundColor= customColors.textInputBg;
      txtInput.style.color= customColors.textInputColor;
      txtInput.style.borderRadius= fieldBorderRadius;

      // reminderDate
      let dInput=document.getElementById('reminderDate');
      dInput.style.backgroundColor= customColors.dateInputBg;
      dInput.style.color= customColors.dateInputColor;
      dInput.style.borderRadius= fieldBorderRadius;

      // reminderTime
      let tInput=document.getElementById('reminderTime');
      tInput.style.backgroundColor= customColors.timeInputBg;
      tInput.style.color= customColors.timeInputColor;
      tInput.style.borderRadius= fieldBorderRadius;

      // reminderCategory
      let catSelect=document.getElementById('reminderCategory');
      catSelect.style.backgroundColor= customColors.categoryBg;
      catSelect.style.color= customColors.categoryColor;
      catSelect.style.borderRadius= fieldBorderRadius;

      // reminderRepeat
      let repSelect=document.getElementById('reminderRepeat');
      repSelect.style.backgroundColor= customColors.repeatBg;
      repSelect.style.color= customColors.repeatColor;
      repSelect.style.borderRadius= fieldBorderRadius;

      // languageSelect
      let langSelect=document.getElementById('languageSelect');
      langSelect.style.backgroundColor= customColors.langBg;
      langSelect.style.color= customColors.langColor;
      langSelect.style.borderRadius= fieldBorderRadius;

      // Кнопка &laquo;Добавить&raquo;
      let addBtn=document.getElementById('addReminder');
      addBtn.style.backgroundColor= customColors.addBtnBg;
      addBtn.style.color          = customColors.addBtnText;
      addBtn.style.borderRadius   = (customColors.addBtnShape==="round")?"30px":"0px";

      // Кнопки &laquo;Удалить&raquo;
      document.querySelectorAll('button.delete').forEach(del=>{
        del.style.backgroundColor= customColors.deleteBtnBg;
        del.style.color          = customColors.deleteBtnText;
        del.style.borderRadius   = (customColors.deleteBtnShape==="round")?"30px":"0px";
      });

      // Кнопка &laquo;Тема&raquo;
      let themeBtn=document.getElementById('themeToggle');
      themeBtn.style.backgroundColor= customColors.themeBtnBg;
      themeBtn.style.color          = customColors.themeBtnText;
      themeBtn.style.borderRadius   = (customColors.themeBtnShape==="round")?"30px":"0px";

      // Блок .reminder-item (фон/текст)
      document.querySelectorAll('.reminder-item').forEach(item=>{
        item.style.backgroundColor= customColors.itemBg;
        item.style.color          = customColors.itemText;
      });

      // Если хотим, чтобы &laquo;заголовок категории&raquo; (category-header) тоже менялся:
      // Можно, например, прописать:
      /*
      document.querySelectorAll('.category-header').forEach(header=>{
        header.style.backgroundColor = customColors.itemBg; // или другой цвет
        header.style.color           = customColors.itemText;
      });
      */
    }

    // ====== 3) ИНИЦИАЛИЗАЦИЯ ПОЛЕЙ В ПАНЕЛИ ======
    function initColorPickers() {
      document.getElementById('bodyBgColor').value   = customColors.bodyBg;
      document.getElementById('bodyTextColor').value = customColors.bodyText;

      const fieldShapes=document.getElementsByName('fieldShape');
      for(let r of fieldShapes){
        r.checked=(r.value===customColors.fieldShape);
      }

      document.getElementById('textInputBg').value    = customColors.textInputBg;
      document.getElementById('textInputColor').value = customColors.textInputColor;
      document.getElementById('dateInputBg').value    = customColors.dateInputBg;
      document.getElementById('dateInputColor').value = customColors.dateInputColor;
      document.getElementById('timeInputBg').value    = customColors.timeInputBg;
      document.getElementById('timeInputColor').value = customColors.timeInputColor;
      document.getElementById('categoryBg').value     = customColors.categoryBg;
      document.getElementById('categoryColor').value  = customColors.categoryColor;
      document.getElementById('repeatBg').value       = customColors.repeatBg;
      document.getElementById('repeatColor').value    = customColors.repeatColor;
      document.getElementById('langBg').value         = customColors.langBg;
      document.getElementById('langColor').value      = customColors.langColor;

      document.getElementById('addBtnBgColor').value   = customColors.addBtnBg;
      document.getElementById('addBtnTextColor').value = customColors.addBtnText;
      const addShapes=document.getElementsByName('addBtnShape');
      for(let r of addShapes){
        r.checked=(r.value===customColors.addBtnShape);
      }

      document.getElementById('deleteBtnBgColor').value   = customColors.deleteBtnBg;
      document.getElementById('deleteBtnTextColor').value = customColors.deleteBtnText;
      const delShapes=document.getElementsByName('deleteBtnShape');
      for(let r of delShapes){
        r.checked=(r.value===customColors.deleteBtnShape);
      }

      document.getElementById('themeBtnBgColor').value    = customColors.themeBtnBg;
      document.getElementById('themeBtnTextColor').value  = customColors.themeBtnText;
      const themeShapes=document.getElementsByName('themeBtnShape');
      for(let r of themeShapes){
        r.checked=(r.value===customColors.themeBtnShape);
      }

      // .reminder-item
      document.getElementById('itemBgColor').value   = customColors.itemBg;
      document.getElementById('itemTextColor').value = customColors.itemText;
    }

    // ====== 4) КНОПКИ БЫСТРЫХ ПРЕСЕТОВ (Белая/Чёрная), ПРИМЕНИТЬ, СБРОСИТЬ ======
    document.getElementById('whiteThemeButton').addEventListener('click',()=>{
      // Полностью белая схема
      customColors.bodyBg   = "#ffffff";
      customColors.bodyText = "#000000";
      customColors.fieldShape="rect";

      customColors.textInputBg="#ffffff";  customColors.textInputColor="#000000";
      customColors.dateInputBg="#ffffff";  customColors.dateInputColor="#000000";
      customColors.timeInputBg="#ffffff";  customColors.timeInputColor="#000000";
      customColors.categoryBg="#ffffff";   customColors.categoryColor="#000000";
      customColors.repeatBg="#ffffff";     customColors.repeatColor="#000000";
      customColors.langBg="#ffffff";       customColors.langColor="#000000";

      customColors.addBtnBg="#ffffff";     customColors.addBtnText="#000000";
      customColors.addBtnShape="rect";
      customColors.deleteBtnBg="#ff5555";  customColors.deleteBtnText="#ffffff";
      customColors.deleteBtnShape="rect";
      customColors.themeBtnBg="#888888";   customColors.themeBtnText="#ffffff";
      customColors.themeBtnShape="rect";

      customColors.itemBg="#fafafa";
      customColors.itemText="#000000";

      initColorPickers();
      applyCustomColors();
    });

    document.getElementById('blackThemeButton').addEventListener('click',()=>{
      // При &laquo;Чёрной теме&raquo;
      // 1) Фон страницы — чёрный, текст — белый
      customColors.bodyBg   = "#000000";
      customColors.bodyText = "#ffffff";
      // 2) Форма полей — скруглённая
      customColors.fieldShape="round";

      // Поля (тёмно-серые)
      customColors.textInputBg="#333333";   customColors.textInputColor="#ffffff";
      customColors.dateInputBg="#333333";   customColors.dateInputColor="#ffffff";
      customColors.timeInputBg="#333333";   customColors.timeInputColor="#ffffff";
      customColors.categoryBg="#333333";    customColors.categoryColor="#ffffff";
      customColors.repeatBg="#333333";      customColors.repeatColor="#ffffff";
      customColors.langBg="#333333";        customColors.langColor="#ffffff";

      // Кнопки
      customColors.addBtnBg="#555555";      customColors.addBtnText="#ffffff";
      customColors.addBtnShape="round";
      customColors.deleteBtnBg="#aa0000";   customColors.deleteBtnText="#ffffff";
      customColors.deleteBtnShape="round";
      customColors.themeBtnBg="#666666";    customColors.themeBtnText="#ffffff";
      customColors.themeBtnShape="round";

      // &laquo;Ячейка&raquo; напоминания — тёмно-серая, текст чёрный
      customColors.itemBg="#666666";
      customColors.itemText="#000000";

      initColorPickers();
      applyCustomColors();
    });

    document.getElementById('saveCustomTheme').addEventListener('click',()=>{
      customColors.bodyBg   = document.getElementById('bodyBgColor').value;
      customColors.bodyText = document.getElementById('bodyTextColor').value;

      const fieldShapes=document.getElementsByName('fieldShape');
      for(let r of fieldShapes) {
        if(r.checked) customColors.fieldShape=r.value;
      }

      customColors.textInputBg    = document.getElementById('textInputBg').value;
      customColors.textInputColor = document.getElementById('textInputColor').value;
      customColors.dateInputBg    = document.getElementById('dateInputBg').value;
      customColors.dateInputColor = document.getElementById('dateInputColor').value;
      customColors.timeInputBg    = document.getElementById('timeInputBg').value;
      customColors.timeInputColor = document.getElementById('timeInputColor').value;
      customColors.categoryBg     = document.getElementById('categoryBg').value;
      customColors.categoryColor  = document.getElementById('categoryColor').value;
      customColors.repeatBg       = document.getElementById('repeatBg').value;
      customColors.repeatColor    = document.getElementById('repeatColor').value;
      customColors.langBg         = document.getElementById('langBg').value;
      customColors.langColor      = document.getElementById('langColor').value;

      // &laquo;Добавить&raquo;
      customColors.addBtnBg   = document.getElementById('addBtnBgColor').value;
      customColors.addBtnText = document.getElementById('addBtnTextColor').value;
      const addShapes=document.getElementsByName('addBtnShape');
      for(let r of addShapes){
        if(r.checked) customColors.addBtnShape=r.value;
      }

      // &laquo;Удалить&raquo;
      customColors.deleteBtnBg   = document.getElementById('deleteBtnBgColor').value;
      customColors.deleteBtnText = document.getElementById('deleteBtnTextColor').value;
      const delShapes=document.getElementsByName('deleteBtnShape');
      for(let r of delShapes){
        if(r.checked) customColors.deleteBtnShape=r.value;
      }

      // &laquo;Тема&raquo;
      customColors.themeBtnBg   = document.getElementById('themeBtnBgColor').value;
      customColors.themeBtnText = document.getElementById('themeBtnTextColor').value;
      const themeShapes=document.getElementsByName('themeBtnShape');
      for(let r of themeShapes){
        if(r.checked) customColors.themeBtnShape=r.value;
      }

      // reminder-item
      customColors.itemBg   = document.getElementById('itemBgColor').value;
      customColors.itemText = document.getElementById('itemTextColor').value;

      saveCustomColors();
      applyCustomColors();
    });

    document.getElementById('resetCustomTheme').addEventListener('click',()=>{
      localStorage.removeItem('customColors');
      customColors = loadCustomColors();
      initColorPickers();
      applyCustomColors();
    });

    // ====== 5) ПОКАЗ/СКРЫТИЕ ПАНЕЛИ &laquo;ТЕМА&raquo; ======
    let themePanelOpen=false;
    const themeToggleBtn=document.getElementById('themeToggle');
    const themePanel=document.getElementById('themePanel');
    themeToggleBtn.addEventListener('click',()=>{
      themePanelOpen=!themePanelOpen;
      themePanel.style.display=themePanelOpen?'block':'none';
    });

    // ====== 6) НАПОМИНАНИЯ (setTimeout+repeat) ======
    let reminderText   = document.getElementById('reminderText');
    let reminderDate   = document.getElementById('reminderDate');
    let reminderTime   = document.getElementById('reminderTime');
    let reminderCategory = document.getElementById('reminderCategory');
    let reminderRepeat = document.getElementById('reminderRepeat');
    let addReminderBtn = document.getElementById('addReminder');

    function saveReminders(){
      localStorage.setItem('reminders', JSON.stringify(reminders));
    }
    function cancelAllTimers(){
      reminderTimeouts.forEach(id=>clearTimeout(id));
      reminderTimeouts=[];
    }
    function formatDate(d){
      let y=d.getFullYear();
      let m=String(d.getMonth()+1).padStart(2,'0');
      let day=String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }
    function formatTime(d){
      let hh=String(d.getHours()).padStart(2,'0');
      let mm=String(d.getMinutes()).padStart(2,'0');
      return `${hh}:${mm}`;
    }
    function addIntervalToDate(dt, repeat){
      switch(repeat){
        case '10m': dt.setMinutes(dt.getMinutes()+10);break;
        case '1h':  dt.setHours(dt.getHours()+1);break;
        case '1d':  dt.setDate(dt.getDate()+1);break;
        case '1w':  dt.setDate(dt.getDate()+7);break;
        case '1M':  dt.setMonth(dt.getMonth()+1);break;
      }
    }
    function showNotification(r){
      if(!("Notification" in window)){
        alert(r.text);
      } else if(Notification.permission==="granted"){
        new Notification("Напоминание",{body:r.text});
      } else {
        alert(r.text);
      }
    }
    function resetAllTimers(){
      cancelAllTimers();
      const now=new Date();

      reminders.forEach(r=>{
        if(!r.date&&!r.time) return;
        let dt=new Date(r.date+'T'+(r.time||'00:00'));
        // Если уже прошло, а есть повтор — двигаем вперёд
        if(dt<=now){
          if(!r.repeat||r.repeat==='none'){
            return;
          }
          while(dt<=now){
            addIntervalToDate(dt,r.repeat);
          }
          r.date=formatDate(dt);
          r.time=formatTime(dt);
          saveReminders();
        }
        let diff=dt-(new Date());
        let tid=setTimeout(()=>{
          showNotification(r);
          if(r.repeat&&r.repeat!=='none'){
            let nd=new Date(dt);
            addIntervalToDate(nd,r.repeat);
            r.date=formatDate(nd);
            r.time=formatTime(nd);
            saveReminders();
            resetAllTimers();
          } else {
            const idx=reminders.indexOf(r);
            if(idx!==-1){
              reminders.splice(idx,1);
              saveReminders();
            }
            renderCategories();
          }
        }, diff);
        reminderTimeouts.push(tid);
      });
    }

    // ====== 7) Категории ======
    function groupByCategory(){
      const groups={"Работа":[],"Личное":[],"Учёба":[]};
      reminders.forEach(rem=>{
        if(!groups[rem.category]){
          groups[rem.category]=[];
        }
        groups[rem.category].push(rem);
      });
      return groups;
    }
    function createCategoryPanel(catName, arr){
      let t=translations[currentLang]||translations.ru;
      let label=catName;
      if(catName==="Работа") label=t.work;
      if(catName==="Личное") label=t.personal;
      if(catName==="Учёба")  label=t.study;

      const panel=document.createElement('div');
      panel.className='category-panel';

      const header=document.createElement('div');
      header.className='category-header';

      const h2=document.createElement('h2');
      h2.textContent=`${label} (${arr.length})`;

      const toggleSign=document.createElement('span');
      toggleSign.textContent='▼';

      header.appendChild(h2);
      header.appendChild(toggleSign);

      const content=document.createElement('div');
      content.className='category-content';

      let isOpen=false;
      header.addEventListener('click',()=>{
        isOpen=!isOpen;
        content.style.display=isOpen?'block':'none';
        toggleSign.textContent=isOpen?'▲':'▼';
      });

      arr.forEach(reminder=>{
        const item=document.createElement('div');
        item.className='reminder-item';

        let txt=reminder.text;
        let details=[];
        if(reminder.date) details.push(reminder.date);
        if(reminder.time) details.push(reminder.time);
        if(reminder.repeat && reminder.repeat!=='none'){
          switch(reminder.repeat){
            case '10m': details.push(t.every10m);break;
            case '1h':  details.push(t.every1h); break;
            case '1d':  details.push(t.every1d); break;
            case '1w':  details.push(t.every1w); break;
            case '1M':  details.push(t.every1M); break;
          }
        }
        if(details.length>0){
          txt+=' ('+details.join(', ')+')';
        }

        const textSpan=document.createElement('span');
        textSpan.textContent=txt;

        const delBtn=document.createElement('button');
        delBtn.className='delete';
        delBtn.textContent=t.deleteBtn;
        delBtn.addEventListener('click',()=>{
          const idx=reminders.indexOf(reminder);
          if(idx!==-1){
            reminders.splice(idx,1);
            saveReminders();
            resetAllTimers();
            renderCategories();
          }
        });

        item.appendChild(textSpan);
        item.appendChild(delBtn);
        content.appendChild(item);
      });

      panel.appendChild(header);
      panel.appendChild(content);
      return panel;
    }
    function renderCategories(){
      const container=document.getElementById('categoriesContainer');
      container.innerHTML='';
      const groups=groupByCategory();
      for(let c in groups){
        if(groups[c].length>0){
          const panel=createCategoryPanel(c, groups[c]);
          container.appendChild(panel);
        }
      }
      applyCustomColors(); 
    }

    // ====== 8) Добавление напоминания ======
    document.getElementById('addReminder').addEventListener('click',()=>{
      const textVal=reminderText.value.trim();
      if(!textVal) return;

      reminders.push({
        text:textVal,
        date:reminderDate.value,
        time:reminderTime.value,
        category:reminderCategory.value,
        repeat:reminderRepeat.value
      });
      saveReminders();
      resetAllTimers();
      renderCategories();

      // Сброс формы
      reminderText.value='';
      reminderDate.value='';
      reminderTime.value='';
      reminderCategory.value='Работа';
      reminderRepeat.value='none';
    });

    // ====== 9) При загрузке страницы ======
    document.addEventListener('DOMContentLoaded',()=>{
      if("Notification" in window){
        if(Notification.permission==="default"){
          Notification.requestPermission();
        }
      }
    });

    // Выставляем язык
    const langSel=document.getElementById('languageSelect');
    langSel.value=currentLang;
    langSel.addEventListener('change', e=>{
      currentLang=e.target.value;
      localStorage.setItem('language', currentLang);
      applyTranslations();
    });

    // Запуск
    applyTranslations();
    initColorPickers();
    applyCustomColors();
    renderCategories();
    resetAllTimers();
  </script>
</body>
</html>
